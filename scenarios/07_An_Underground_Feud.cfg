#textdomain wesnoth-AD

[scenario]
    id=07_An_Undergrond_Feud
    name= _ "An Underground Feud"
    map_data="{~add-ons/Ashevieres_Dogs/maps/07_An_Undergrond_Feud.map}"

    {TURNS 36 33 30}
    next_scenario=08_The_End_of_the_War
    victory_when_enemies_defeated=no
    carryover_percentage=40
    carryover_add=yes

    {UNDERGROUND}

    {SCENARIO_MUSIC underground.ogg}
    {EXTRA_SCENARIO_MUSIC the_deep_path.ogg}
    {EXTRA_SCENARIO_MUSIC into_the_shadows.ogg}

    [story]
        [part]
            story=_ "With Queen Asheviere from the south and General Henri from the north, Dan'Tonk was now surrounded. The soldiers of the crown were more motivated than ever — they hoped that with the fall of Dan'Tonk, the civil war would end and the country could thrive in peace."
            {AD_BIGMAP}
            {JOURNEY_05_OLD}
        [/part]
        [part]
            story=_ "But victory would not come easy. Dan'Tonk was a fortress nigh-unto Weldyn itself, and still maintained a garrison of several thousand soldiers even after Baron de Ferres's defeats. Both Ashevire and the rebel lords would have to risk their entire army in the impending fight."
            {AD_BIGMAP}
            {JOURNEY_05_OLD}
        [/part]
        [part]
            story=_ "An pivotal role in the battle would be played by Bazur and Isolde, who made their way through a dark tunnel into the heart of the rebel lair."
            {AD_BIGMAP}
            {JOURNEY_05_OLD}
        [/part]
    [/story]

    {AD_TRACK {JOURNEY_06_NEW} }

    {STARTING_VILLAGES 2 3}
    {STARTING_VILLAGES 3 15}
    {STARTING_VILLAGES 4 15}

    [side]
        side=1
        controller=human
        gold=75
        {INCOME 5 3 1}
        fog=no
        shroud=yes
        share_vision=all
        {BAZUR_ARC_I}
        #recruit=Orcish Grunt,Orcish Archer,Wolf Rider,Goblin Spearman,Orcish Assassin
        color=white
        team_name=bazur
        user_team_name= _ "Asheviere's Forces"
        save_id=bazur
        {FLAG_VARIANT ragged}
    [/side]

    [side]
        side=2
        controller=ai
        gold=50
        income=5
        fog=no
        shroud=no
        share_vision=all
        type=Royal Guard
        id=Ron 
        name=_ "Ron"
        profile="portraits/humans/swordsman-2.webp"
        extra_recruit=Swordsman
        [modifications]
            {TRAIT_STRONG}
            {TRAIT_RESILIENT}
        [/modifications]
        canrecruit=yes 
        recruit=Swordsman
        color=blue
        team_name=rebels
        user_team_name= _ "Rebel Forces"

        {FLAG_VARIANT loyalist}

        [ai]
            [avoid]
                [not]
                    x,y=14,15
                    radius=3 
                [/not]
            [/avoid]
        [/ai]
    [/side]

    [side]
        side=3
        controller=ai
        {GOLD 75 150 225}
        {INCOME 1 3 5}
        fog=no
        shroud=no
        share_vision=all
        type=Fire Ant Queen
        id=Chuchelka
        name=_ "Chuchelka I"
        color=green
        team_name=chuchelka
        user_team_name= _ "Chuchelka's Forces"

        [unit]
            type=Shadow Lord
            id=Dwarf
            name=_ "Dwarf"
            profile="portraits/dwarf.png"
            x,y=25,26
            ai_special=guardian
            [modifications]
                {TRAIT_INTELLIGENT}
                {TRAIT_HEALTHY}
                {TRAIT_LOYAL_HERO_NOSLOT}
            [/modifications]
        [/unit]

        [unit]
            type=Highwayman
            name=_ "Mech"
            id=Mech
            x,y=23,27
            ai_special=guardian
            [modifications]
                {TRAIT_MECHANICAL}
                {TRAIT_STRONG}
                {TRAIT_LOYAL_HERO_NOSLOT}
            [/modifications]
        [/unit]
    [/side]

    [side]
        side=4
        controller=ai
        {GOLD 75 150 225}
        {INCOME 1 3 5}
        fog=no
        shroud=no
        share_vision=all
        type=Giant Ant Queen
        id=Evil_Chuchelka
        name=_ "False Chuchelka"
        color=purple
        team_name=rebel_chuchelka
        user_team_name= _ "False Chuchelka's Forces"
    [/side]

    {PEASANT_SIDE 5}

    {AD_MARAUDERS}
    
    {AD_RECRUIT_EVENT}
    {AD_LOYALS_EVENTS}

    {HERODEATH_ACT_I}

    [event]
    name=prestart 

        {PLACE_IMAGE items/gohere.png 10 31}

        [recall]
            id=Isolde
        [/recall]

        [recall]
            id=Grump
            x,y=28,3
        [/recall]

        [if]
            [not]
                [have_unit]
                    id=Grump
                    x,y=28,3
                [/have_unit]
            [/not]
        [then]
            [unit]
                side=1
                type=Troll 
                id=Grogr 
                name=_ "Grogr"
                [modifications]
                    {TRAIT_STRONG}
                    {TRAIT_LOYAL}
                [/modifications]
                x,y=28,3
            [/unit]
        [/then]
        [/if]

        {FORCE_CHANCE_TO_HIT side=3 role=first_guard 60 ()}
        {FORCE_CHANCE_TO_HIT side=4 role=first_guard 60 ()}

        {UNIT 2 Swordsman 20 9 (role=first_guard)}
        {UNIT 2 Swordsman 19 10 (role=first_guard)}
        {UNIT 2 Swordsman 20 10 (role=first_guard)}

        {GENERIC_UNIT 3 "Firebomb Ant" 21 10}
        {GENERIC_UNIT 3 "Firebane Ant" 20 10}
        {GENERIC_UNIT 3 "Fire Ant" 21 11}

        {GENERIC_UNIT 4 "Soldier Ant" 19 9}
        {GENERIC_UNIT 4 "Soldier Ant" 18 9}
        {GENERIC_UNIT 4 "Giant Ant" 18 10}

        {GENERIC_UNIT 3 "Fire Ant" 27 22}
        {GENERIC_UNIT 3 "Firebane Ant" 28 21}
        {GENERIC_UNIT 3 "Firebomb Ant" 28 21}

        [allow_recruit]
            side=3
            type=Fire Ant,Firebane Ant,Firebomb Ant 
        [/allow_recruit]

        [allow_recruit]
            side=4
            type=Giant Ant,Soldier Ant
        [/allow_recruit]

        [micro_ai]
            side=3
            ai_type=simple_attack
            action=add

            [filter]
                side=3
            [/filter]
            [filter_second]
                side=2
            [/filter_second]
        [/micro_ai]

        [micro_ai]
            side=4
            ai_type=simple_attack
            action=add

            [filter]
                side=4
            [/filter]
            [filter_second]
                side=2
            [/filter_second]
        [/micro_ai]

        {MODIFY_AI_ADD_GOAL 3 (
            [goal]
                id=target_chuchelkas3
                name=target_unit
                [criteria]
                    side=2,4
                [/criteria]
                value=5
            [/goal]
        )}
        {MODIFY_AI_ADD_GOAL 4 (
            [goal]
                id=target_chuchelkas4
                name=target_unit
                [criteria]
                    side=2,3
                [/criteria]
                value=5
            [/goal]
        )}
    [/event]

    [event]
    name=turn 2 

        {GENERIC_UNIT 3 "Fire Ant" 16 19}
        {GENERIC_UNIT 3 "Fire Ant" 17 17}
        {GENERIC_UNIT 4 "Soldier Ant" 9 15}
        {GENERIC_UNIT 4 "Soldier Ant" 12 12}
    [/event]

    [event]
    name=side 3 turn 
    first_time_only=no 

        [if]
            [have_unit]
                [filter_side]
                    [enemy_of]
                        side=3
                    [/enemy_of]
                [/filter_side]
                [filter_location]
                    x,y,radius=26,29,5
                [/filter_location]
                count=2-100 
            [/have_unit]
        [then]
            [allow_recruit]
                side=3
                type=Fire Ant Egg 
            [/allow_recruit]

            [disallow_recruit]
                side=3 
                type=Fire Ant,Firebane Ant,Firebomb Ant 
            [/disallow_recruit]
        [/then]

        [else]
            [allow_recruit]
                side=3
                type=Fire Ant,Firebane Ant,Firebomb Ant 
            [/allow_recruit]

            [disallow_recruit]
                side=3 
                type=Fire Ant Egg
            [/disallow_recruit]
        [/else]
        [/if]
    [/event]

    [event]
    name=side 4 turn 
    first_time_only=no 

        [if]
            [have_unit]
                [filter_side]
                    [enemy_of]
                        side=4
                    [/enemy_of]
                [/filter_side]
                [filter_location]
                    x,y,radius=4,3,5
                [/filter_location]
                count=2-100 
            [/have_unit]
        [then]
            [allow_recruit]
                side=4
                type=Giant Ant Egg 
            [/allow_recruit]

            [disallow_recruit]
                side=4
                type=Giant Ant,Soldier Ant
            [/disallow_recruit]
        [/then]

        [else]
            [allow_recruit]
                side=4
                type=Giant Ant,Soldier Ant
            [/allow_recruit]

            [disallow_recruit]
                side=4
                type=Giant Ant Egg
            [/disallow_recruit]
        [/else]
        [/if]
    [/event]

    [event]
    name=start 

        [message]
            speaker=Bazur 
            message=_ "... That Henri of yours, he's so angry! But that's good; a leader must be angry."
        [/message]

        [message]
            speaker=Isolde
            message=_ "I hope you remember his words well, Bazur."
        [/message]

        [message]
            speaker=Bazur 
            message=_ "Words! Words are garbage, but I'll never forget how he executed those chiefs!"
        [/message]

        [message]
            speaker=Isolde
            message=_ "If you make the general angry, the same thing will happen to you, so try not to get in his face."
        [/message]

        [message]
            speaker=Bazur 
            message=_ "Uh-huh. What about the tunnel, how far is it?"
        [/message]

        [message]
            speaker=Isolde
            message=_ "By my calculations, we're still a few days away from Dan'Tonk. I can't wait to get to the surface. I'm depressed by this cave's awful cold and dark."
        [/message]

        [store_unit]
            [filter]
                side=1
                race=troll 
            [/filter]
            variable=troll 
            kill=no 
        [/store_unit]

        [message]
            speaker=Bazur 
            message=_ "My trolls enjoy it! Right, $troll.name"
        [/message]

        [message]
            side=1
            race=troll
            message=_ "Yeah. $troll.name want to stay here and live here after war is done."
        [/message]

        {CLEAR_VARIABLE troll}

        [message]
            speaker=Isolde
            message=_ "Not likely. Let's move!"
        [/message]

        [objectives]
            silent=no
                [objective]
                    description= _ "Move Bazur to the end of the tunnel"
                    condition=win
                [/objective]
                [objective]
                    [show_if]
                        [variable]
                            name=save_chu
                            numerical_equals=1
                        [/variable]
                        [and]
                            [have_unit]
                                id=False_Chuchelka 
                            [/have_unit]
                        [/and]
                    [/show_if]
                    caption=_ "Bonus mission"
                    description= _ "Destroy the Queen of the grey ants"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Death of Bazur"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Death of Isolde"
                    condition=lose
                [/objective]
                {TURNS_RUN_OUT}
                [gold_carryover]
                    bonus=yes
                    carryover_percentage=40
                    carryover_add=yes
                [/gold_carryover]
        [/objectives]   
    [/event]

    [event]
    name=sighted 

        [filter]
            side=2
        [/filter]

        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=unit 
            message=_ "Ahhh, they're everywhere!"
        [/message]

        [message]
            speaker=Bazur
            message=_ "Rebels, at last! My arms are getting stiff, well, let's warm up!"
        [/message]

        [message]
            race=troll
            message=_ "And crawlers! Crawlers great!"
        [/message]

        [message]
            speaker=Isolde
            message=_ "Not great! Get forward and clear the way of rebels and ants! Especially ants!"
        [/message]
    [/event]

    [event]
    name=turn 4

        [message]
            speaker=Bazur
            message=_ "Where to next?"
        [/message]

        [message]
            speaker=Isolde
            message=_ "Oh no, the passageway's blocked. Now... Now we have to travel through the holes dug by those critters."
        [/message]

        [message]
            speaker=Bazur
            message=_ "I hear them coming this way! Dozens, no, hundreds! On both sides!"
        [/message]

        [message]
            speaker=Isolde
            message=_ "Damn it, let's fight through one of the side tunnels. Quick!"
        [/message]
    [/event]

    [event]
    id=saw_door
    name=moveto 
    first_time_only=no 

        [if]
            [have_location]
                x,y=11,22
                [filter_vision]
                    side=1
                [/filter_vision]
            [/have_location]
        [then]
            [scroll_to]
                x,y=11,22
            [/scroll_to]

            [message]
                speaker=Isolde
                message=_ "It's the gateway to the catacombs of Dun-Tonk. We made it! But it's locked — what do we do?"
            [/message]

            [message]
                speaker=Bazur
                message=_ "Just get me to that gate. I'll knock it down!"
            [/message]

            [remove_event]
                id=saw_door
            [/remove_event]
        [/then]
        [/if]
    [/event]

    [event]
    name=moveto 

        [filter]
            id=Bazur 
            [filter_location]
                x,y,radius=11,22,1
            [/filter_location]
        [/filter]

        [terrain]
            x,y=11,22
            terrain=Rr^Pr\o
        [/terrain]

        [redraw] [/redraw]

        [sound]
            name=mace.ogg
        [/sound]

        [message]
            speaker=Bazur
            message=_ "I told you, I can knock down a gate in a heartbeat!"
        [/message]

        {GENERIC_UNIT 5 Halberdier 8 28}
        {GENERIC_UNIT 5 Halberdier 10 28}
        {GENERIC_UNIT 5 Lieutenant 9 29}
        {GENERIC_UNIT 5 Swordsman 8 29}
        {GENERIC_UNIT 5 Pikeman 10 29}
    [/event]

    [event]
    name=sighted 

        [filter]
            side=5
        [/filter]

        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=unit
            message=_ "This is as far as you get, you royalist dogs!"
        [/message]

        [message]
            speaker=Isolde
            message=_ "We'll see about that!"
        [/message]

        [event]
            name=new_turn 
            first_time_only=yes

            [sound]
                name=explosion.ogg
            [/sound]

            {QUAKE ()}
           
            [sound]
                name=rumble.ogg
            [/sound]

            [sound]
                name=cave-in.ogg
            [/sound]

            [message]
                speaker=Bazur
                message=_ "What's that?"
            [/message]

            [message]
                speaker=Isolde
                message=_ "The royal army must be fireballing the city. The Queen's assault is about to begin — we must hurry."
            [/message]

            [message]
                speaker=Bazur
                message=_ "Great!"
            [/message]

            [event]
                name=new_turn 
                first_time_only=no

                [sound]
                    name=explosion.ogg
                [/sound]

                {QUAKE ()}
            
                [sound]
                    name=rumble.ogg
                [/sound]

                [sound]
                    name=cave-in.ogg
                [/sound]
            [/event]
        [/event]
    [/event]

    [event]
        name=last breath 
        [filter]
            id=Ron 
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        [message]
            speaker=unit
            message=_ "I beg for mercy, or at least honorable death by the hand of a knight!"
        [/message]
        [message]
            speaker=Bazur
            message=_ "Why not at the hand of an orc?"
        [/message]
        [message]
            speaker=Isolde
            message= _ ""
            [option]
                label= _ "I'm a knight. Accept your death, warrior."
                [command]
                    [kill]
                        id=Ron 
                        animate=yes 
                    [/kill]
                    [message]
                        speaker=Bazur
                        message=_ "Look, spoils of war! He dropped his fancy helmet, and it's barely dented. Someone should go pick it up."
                    [/message]

                    {VARIABLE helmetX $x1}
                    {VARIABLE helmetY $y1}

                    {HIGHLIGHT_IMAGE $helmetX $helmetY "misc/helmet-big.png" ()}
                    {PLACE_IMAGE "misc/helmet-big.png" $x1 $y1}
                    
                    [message]
                        speaker=Isolde
                        message=_ "You're incorrigible, Bazur."
                    [/message]
                    
                    
                    [event]
                        name=moveto
                        id=take_item
                        first_time_only=no 
                        [filter]
                            side=1
                            type_adv_tree=Troll Whelp,Troll Hero
                            [filter_location]
                                x,y=$helmetX,$helmetY
                            [/filter_location]
                        [/filter]

                        [message]
                            speaker=unit
                            message= _ "This helmet will protect me from blade and pierce (+10%) damage. I'll be braver to rush into the battlefield with it on! (+1 move)."
                            [option]
                                label= _ "I'll take it."
                                [command]
                                    {REMOVE_IMAGE $helmetX $helmetY}
                                    [remove_event]
                                        id=take_item
                                    [/remove_event]
                                    [remove_event]
                                        id=take_item2
                                    [/remove_event]

                                    {CLEAR_VARIABLE helmetX}
                                    {CLEAR_VARIABLE helmetY}

                                    [object]
                                        name=_"Royal Helm"
                                        image="icons/helmet_frogmouth.png"
                                        description= _ "Only lightly dented, this gilded helm once belonged to the captain of Dan'tonk's swordsmen."
                                        duration=forever
                                        [filter]
                                            find_in=unit
                                        [/filter]
                                        [effect]
                                            apply_to=resistance
                                            replace=no 
                                            [resistance]
                                                blade=-10
                                                pierce=-10
                                            [/resistance]
                                        [/effect]
                                        [effect]
                                            apply_to=movement
                                            increase=1
                                        [/effect]
                                        [effect]
                                            apply_to=overlay 
                                            add="misc/item-overlay.png"
                                        [/effect]
                                    [/object]

                                    [message]
                                        speaker=unit 
                                        message=_ "The troll head too big. Helmet no fit. Put it on my groin."
                                    [/message]
                                    {FIRST_ITEM_EVENT}
                                [/command]
                            [/option]
                            [option]
                                label= _ "I'll leave this for someone else."
                                [command]
                                    [allow_undo] 
                                    [/allow_undo]
                                [/command]
                            [/option]
                        [/message]
                    [/event]

                    [event]
                        name=moveto
                        id=take_item2
                        first_time_only=no 
                        [filter]
                            side=1
                            [not]
                                type_adv_tree=Troll Whelp,Troll Hero
                            [/not]
                            [filter_location]
                                x,y=$helmetX,$helmetY
                            [/filter_location]
                        [/filter]
                        [message]
                            speaker=unit
                            message= _ "This helmet will protect me from blade and pierce (+10%) damage. I'll be braver to rush into the battlefield with it on! (+1 move)."
                            [option]
                                label= _ "I'll take it."
                                [command]
                                    {REMOVE_IMAGE $helmetX $helmetY}
                                    [remove_event]
                                        id=take_item
                                    [/remove_event]
                                    [remove_event]
                                        id=take_item2
                                    [/remove_event]

                                    {CLEAR_VARIABLE helmetX}
                                    {CLEAR_VARIABLE helmetY}

                                    [object]
                                        name=_"Royal Helm"
                                        image="icons/helmet_frogmouth.png"
                                        description= _ "Only lightly dented, this gilded helm once belonged to the captain of Dan'tonk's swordsmen."
                                        duration=forever
                                        [filter]
                                            find_in=unit
                                        [/filter]
                                        [effect]
                                            apply_to=resistance
                                            replace=no 
                                            [resistance]
                                                blade=-10
                                                pierce=-10
                                            [/resistance]
                                        [/effect]
                                        [effect]
                                            apply_to=movement
                                            increase=1
                                        [/effect]
                                    [/object]
                                [/command]
                            [/option]
                            [option]
                                label= _ "I'll leave this for someone else."
                                [command]
                                    [allow_undo] 
                                    [/allow_undo]
                                [/command]
                            [/option]
                        [/message]
                    [/event]
                [/command]
            [/option]

            [option]
                label= _ "I will not kill you. Stand up and tell me what's going on here."
                [command]
                    [message]
                        speaker=unit
                        message=_ "Thank you! I thought I was going to die in this hellhole!"
                    [/message]

                    [message]
                        speaker=unit
                        message=_ "I am Ron, commander of the swordsmen of Dan'Tonk. I served the Baron de Ferres. When the city was besieged, my lord sent me to the catacombs. Me and my best swordsmen to the catacombs!"
                    [/message]
                    
                    [message]
                        speaker=unit
                        message=_ "It was quiet at first, but then the shelling started. The passageway collapsed, and out of the holes in the walls came these vile creatures! I don't know if it was the noise or what, but they just keep coming and coming, outnumbering us ten-to-one! Almost all my swordsmen died fighting them. I can't believe my lord would send us to such a horrible and ignominious death!"
                    [/message]

                    [message]
                        speaker=Isolde
                        message=_ "Dan'Tonk will soon be taken and de Ferres will be strung up on the gallows. Join us, Ron, we have a task worthy of your swordsmen."
                    [/message]

                    [message]
                        speaker=unit
                        message=_ "My lord ruined me, and you saved my life. I'll join you. De Ferres will regret treating us like fodder!"
                    [/message]

                    {TRANSFER_VILLAGE_OWNERSHIP 2 1} 
                    {MODIFY_UNIT id=Ron hitpoints 25}

                    [modify_unit]
                        [filter]
                            side=2
                        [/filter]
                        side=1
                    [/modify_unit]

                    [object] 
                        silent=no
                        name= _ "Ron's squad"
                        image="units/human-loyalists/swordsman.png~RC(magenta>white)"
                        duration=scenario
                        description= _ "Ron has joined you. He is a leader, and can recruit Swordsmen when standing on a keep."
                        [filter]
                            find_in=unit 
                        [/filter]
                    [/object]
                [/command]
            [/option]
        [/message]
    [/event]

    [event]
    name=moveto
    first_time_only=yes 

        [filter]
            id=Bazur
            [filter_location]
                x,y=10,31
            [/filter_location]
        [/filter]

        {REMOVE_IMAGE 10 31}

        {REPLACE_SCENARIO_MUSIC revelation.ogg}

        [message]
            speaker=Bazur 
            message=_ "It's quiet, let's go in!"
        [/message]

        [message]
            speaker=Isolde
            message=_ "Wait a moment, I want to ask you something. Why do you orcs always delight in carnage and bloodshed? Why is it that even now, when we are about to find ourselves in the heart of a rebel lair and will most likely die, you are smiling and eager to move forward?"
        [/message]

        [message]
            speaker=Bazur 
            message=_ "An orc is defined by the battle in which he died. The bigger and scarier the battle, the better. If I die in the biggest battle of your war, in the middle of a huge fortress, surrounded by all those lords in shining armor, then I was a great orc! War-songs will be sung about my valor, and all the Whitefangs will envy my glorious death!"
        [/message]

        [message]
            speaker=Isolde
            message=_ "It's hard to understand you. Humans are defined more by what they do in peacetime."
        [/message]

        [message]
            speaker=Bazur 
            message=_ "Whoever sows the most stinky weed! Ha-ha-ha"
        [/message]

        [message]
            speaker=Isolde
            message=_ "And more. I'd like to survive the coming battle, you know."
        [/message]

        [message]
            speaker=Bazur 
            message=_ "What for?"
        [/message]

        [message]
            speaker=Isolde
            message=_ "I want to return to a peaceful life when the war is over. First because of Garard and now because of these rebels, I've had to waste the best years of my life in bloodshed."
        [/message]

        [message]
            speaker=Bazur 
            message=_ "That's great! Peace is for wimps!"
        [/message]

        [message]
            speaker=Isolde
            message=_ "Have you never lived peacefully yourself? Did you ever start a family, have children?"
        [/message]

        [message]
            speaker=Bazur 
            message=_ "Sure I did! But every son is a bastard who will sooner or later try to kill you and take your place, so I'm glad I escaped from them to you!"
        [/message]

        [message]
            speaker=Isolde
            message=_ "That's how."
        [/message]

        [message]
            speaker=Bazur 
            message=_ "Okay, don't screw your face up like that. I'll have my grunts cover you more if you want to survive so badly! Now let's get up there — I can't wait to see this Dan'Tonk of yours, and to meet the chief rebel himself!"
        [/message]

        [endlevel]
            result=victory
            carryover_add=yes 
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]

    [event]
    name=die 

        [filter]
            id=Chuchelka 
        [/filter]

        [modify_ai]
            side=4
            action=delete
            path=goal[target_chuchelkas4]
        [/modify_ai]
    [/event]

    [event]
    name=die 

        [filter]
            id=Evil_Chuchelka 
        [/filter]

        [modify_ai]
            side=3
            action=delete
            path=goal[target_chuchelkas3]
        [/modify_ai]

        [message]
            speaker=Bazur 
            message=_ "The foul creature is crushed! And you were afraid, Isolde!"
        [/message]

        [if]
            [variable]
                name=save_chu 
                numerical_equals=1 
            [/variable]
        [then]
            [message]
                speaker=Dwarf
                message=_ "Thank you for your help! Queen Chuchelka will provide you with soldiers to bring law and order to your lands."
            [/message]

            {REPEAT 6 (
            {UNIT 1 "Fire Ant" 25 28 (
            recall_cost=0
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            animate=yes
            )}
            )}

            [message]
                speaker=Bazur 
                message=_ "Ha! Queen Chuchelka is more willing to provide backup than Queen Asheviere!"
            [/message]

            [message]
                speaker=Isolde
                message=_ "Shut up."
            [/message]
        [/then]

        [else]
        [/else]
    [/if]
    [/event]

    [event]
    name=die 

        [filter]
            id=Chuchelka 
        [/filter]

        [message]
            speaker=Bazur 
            message=_ "Fire creature's dead. Ugh, it's gotten all over my shoes."
        [/message]

        [if]
            [have_unit]
                side=3
                race=human 
            [/have_unit]
    
        [then]
            [message]
                side=3
                race=human 
                message=_ "No, Chuchelka, our Queen! Who will protect us now from the chaos of war?"
            [/message]
        [/then]

        [else]
        [/else]
    [/if]
    [/event]

    [event]
    name=last_breath

        [filter]
            id=Mech
        [/filter]

        [message]
            speaker=unit
            message=_ "I died in my own story!"
        [/message]
    [/event]

    [event]
    name=last_breath

        [filter]
            id=Dwarf
        [/filter]

        [message]
            speaker=unit
            message=_ "You'll regret killing us, you'll see."
        [/message]
    [/event]  

    [event]
    name=sighted 

        [filter]
            side=3
            race=human 
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [remove_shroud]
            x,y=24,27
            radius=3
            side=1
        [/remove_shroud]

        [redraw][/redraw]

        [scroll_to]
            id=Dwarf 
        [/scroll_to]

        [message]
            speaker=Bazur 
            message=_ "What are humans doing in an ant den?!"
        [/message]

        [message]
            speaker=Isolde
            message=_ "Hey, you! Are you fighting for the Queen or for the rebels?"
        [/message]

        [message]
            speaker=Dwarf
            message=_ "For the Queen, of course. And she's in danger!"
        [/message]

        [message]
            speaker=Isolde
            message=_ "Our people."
        [/message]

        [message]
            speaker=Mech
            message=_ "The damned rebels want to overthrow our Queen Chuchelka!"
        [/message]

        [message]
            speaker=Isolde
            message=_ "What did you call Asheviere?!"
        [/message]

        [message]
            speaker=Dwarf
            message=_ "What kind of Asheviere? We're talking about our Queen Chuchelka! And we don't give a damn about your surface squabbles."
        [/message]

        [message]
            speaker=Isolde
            message=_ "So you don't support the Wesnoth Crown?"
        [/message]

        [message]
            speaker=Mech
            message=_ "We don't support anyone. We don't care about the crown of Wesnoth. We have our own war to fight, more important than yours."
        [/message]

        [message]
            speaker=Isolde
            message=_ "Bazur, cut them down. We can't advance with these crazies in the rear."
        [/message]

        [message]
            speaker=Bazur 
            message=_ "Oh, wait a minute, they're funny. What kind of war you got going on here?"
        [/message]

        [message]
            speaker=Dwarf
            message=_ "We lived peacefully in these caves with Queen Chuchelka. Together with the ants, we grew mushrooms and fought off roving soldiers. Everything was fine."
        [/message]

        [message]
            speaker=Mech
            message=_ "Until the False Chuchelka came! She's taken over the other end of the cave and now she wants to destroy our Queen!"
        [/message]

        [message]
            speaker=Dwarf
            message=_ "Perhaps you can help us? If you destroy the False Chuchelka, our Queen will thank you."
        [/message]

        [if]

            [have_unit]
                id=Evil_Chuchelka
            [/have_unit]

            [then]

            [message]
                speaker=Bazur 
                message= _ "Looks like another Queen needs help from the orcs!"
                    [option]
                        label= _ "All right, I'll help you."
                        [command]
                            [message]
                                speaker=Isolde
                                message=_ "Are you crazy? We don't have time for this nonsense, we have to go to Dan'Tonk!"
                            [/message]
                            [message]
                                speaker=Bazur
                                message=_ "Don't freak out, a bunch of ants is nothing against orcs, we won't be here long."
                            [/message]

                            [modify_side]
                                side=3
                                team_name=bazur 
                                user_team_name=_ "Queen Chuchelka's Forces"
                            [/modify_side]

                            [modify_side]
                                side=4
                                user_team_name=_ "Evil Chuchelka's Forces"
                            [/modify_side]

                            [message]
                                speaker=Dwarf
                                message=_ "Thank you very much! The Queen Chuchelka says her ants won't attack you anymore."
                            [/message]

                            {VARIABLE_OP save_chu add 1}
                        [/command]
                    [/option]

                    [option]
                        label= _ "We don't have time for this."
                        [command]

                            [message]
                                speaker=Dwarf
                                message=_ "Then you will die, as will all the enemies of Chuchelka!"
                            [/message]
                        [/command]
                    [/option]
            [/message]
        [/then]

        [else]

            [message]
                speaker=Bazur 
                message=_ "We've already squashed some nasty ant Queen on the opposite side of the cave. I think it was the False Chuchelka."
            [/message]

            [message]
                speaker=Dwarf
                message=_ "Is that so? Well, in that case, Queen Chuchelka wants to thank you."
            [/message]

            [message]
                speaker=Isolde
                message=_ "It's not worth wasting time talking to these madmen. Either slaughter them or move on to the end of the tunnel."
            [/message]

            [message]
                speaker=Bazur 
                message= _ "I think..."
                    [option]
                        label= _ "All right, I'll accept your Queen's thanks."
                        [command]

                            [modify_side]
                                side=3
                                team_name=bazur 
                                user_team_name=_ "Queen Chuchelka's Forces"
                            [/modify_side]

                            [modify_side]
                                side=4
                                user_team_name=_ "False Chuchelka's Forces"
                            [/modify_side]

                            [message]
                                speaker=Dwarf
                                message=_ "As you should. Queen Chuchelka will provide you with soldiers to bring law and order to your lands too."
                            [/message]

                            {REPEAT 6 (
                            {UNIT 1 "Fire Ant" 25 28 (
                            recall_cost=0
                            [modifications]
                                {TRAIT_LOYAL}
                            [/modifications]
                            animate=yes
                            )}
                            )}

                            [message]
                                speaker=Bazur 
                                message=_ "Ha! Queen Chuchelka is more willing to provide backup than Queen Asheviere!"
                            [/message]

                            [message]
                                speaker=Isolde
                                message=_ "Shut up."
                            [/message]
                            
                            {VARIABLE_OP save_chu add 1}
                        [/command]
                    [/option]

                    [option]
                        label= _ "I don't need thanks from some stinky ants!"
                        [command]

                            [message]
                                speaker=Dwarf
                                message=_ "Then you will die, as will all the enemies of Chuchelka!"
                            [/message]

                        [/command]
                    [/option]
            [/message]
        [/else]
        [/if]
    [/event]
    
    [event]
    name=die 

        [filter]
            side=3,4
            canrecruit=yes 
        [/filter]

        [set_achievement]
            content_for=ashevieres_dogs
            id=ad_ants
        [/set_achievement]
    [/event]

    [event]
    name=die 

        [filter]
            id=Mech
        [/filter]

        {VARIABLE clubX $x1}
        {VARIABLE clubY $y1}

        [message]
            scroll=no
            speaker=Bazur
            message=_ "This bandit's club is not an ordinary club!"
        [/message]

        {HIGHLIGHT_IMAGE $clubX $clubY items/club.png ()}
        {PLACE_IMAGE items/club.png $x1 $y1}

        [event]
        name=moveto
        id=take_club
        first_time_only=no 

            [filter]
                side=1
                [not]
                    race=troll 
                [/not]
                [filter_location]
                    x,y=$clubX,$clubY
                [/filter_location]
            [/filter]

            [message]
                speaker=unit
                message= _ "That club inspires terror. With it, I can break the bones of my enemies with any weapon in my hands! (+1 melee damage and impact secondary damage type to melee attacks)."

                [option]
                    label= _ "I'll take it."

                    [command]

                    {REMOVE_IMAGE $clubX $clubY}

                    [remove_event]
                        id=take_club
                    [/remove_event]
                    [remove_event]
                        id=take_club_troll
                    [/remove_event]

                    {CLEAR_VARIABLE clubX}
                    {CLEAR_VARIABLE clubY}

                        [object]
                            name= _ "Club of Terror"
                            image=attacks/mace-spiked.png
                            description= _ "A monstrous club crafted in the darkest corners of Irdya would become a mighty weapon in the hands of a slightly more fortunate warrior than the bandit Mech."

                            [effect]
                                apply_to=attack 
                                range=melee 
                                increase_damage=1
                                [set_specials]
                                    mode=append
                                    [damage_type]
                                        id=club of terror
                                        name=_"club of terror"
                                        description=_"This attack deals impact damage if the target is more vulnerable to impact."
                                        alternative_type=impact
                                    [/damage_type]
                                [/set_specials]
                            [/effect]
                            [effect]
                                apply_to=overlay 
                                add="misc/item-overlay.png"
                            [/effect]
                        [/object]
                        {FIRST_ITEM_EVENT}
                    [/command]
                [/option]

                [option]
                    label= _ "No, I think someone else should wear it."

                    [command]

                        [allow_undo] 
                        [/allow_undo]
                        
                    [/command]
                [/option]
            [/message]
        [/event]

        [event]
        name=moveto
        id=take_club_troll
        first_time_only=no 

            [filter]
                side=1
                race=troll 
                [filter_location]
                    x,y=$clubX,$clubY
                [/filter_location]
            [/filter]

            [message]
                speaker=unit
                message= _ "That club inspires terror. With it, I can break the bones of my enemies with any weapon in my hands! (+1 melee damage and impact secondary damage type to melee attacks)."

                [option]
                    label= _ "I'll take it."

                    [command]

                    {REMOVE_IMAGE $clubX $clubY}

                    [remove_event]
                        id=take_club_troll
                    [/remove_event]
                    [remove_event]
                        id=take_club
                    [/remove_event]

                    {CLEAR_VARIABLE clubX}
                    {CLEAR_VARIABLE clubY}

                    {SOUND magic-dark-big.ogg}
                    {SOUND {SOUND_LIST:TROLL_HIT}}

                        [object]
                            name= _ "Club of Terror"
                            image=attacks/mace-spiked.png
                            description= _ "In the troll's hands, the Club of Terror has found its true power. The troll gains +1 to melee attacks!"

                            [effect]
                                apply_to=attack 
                                range=melee 
                                increase_attacks=1
                                set_description=_ "Club of Terror"
                                set_icon=attacks/mace-spiked.png
                            [/effect]
                        [/object]
                    [/command]
                [/option]

                [option]
                    label= _ "No, I think someone else should wear it."

                    [command]

                        [allow_undo] 
                        [/allow_undo]
                        
                    [/command]
                [/option]
            [/message]
        [/event]
        [event]
        name=victory 

            {CLEAR_VARIABLE clubX}
            {CLEAR_VARIABLE clubY}
        [/event]
    [/event]

    [event]
    name=die 

        [filter]
            id=Dwarf
        [/filter]

        [message]
            scroll=no
            speaker=Bazur
            message=_ "This madman's cloak exudes dark power! Someone has to wear it!"
        [/message]

        {VARIABLE dwarf_cloakX $unit.x}
        {VARIABLE dwarf_cloakY $unit.y}

        {HIGHLIGHT_IMAGE $unit.x $unit.y "items/cloak-grey.png" ()}
        {PLACE_IMAGE $dwarf_cloakX $dwarf_cloakY "items/cloak-grey.png"}

        [event]
        name=moveto
        id=take_dwarf_cloak
        first_time_only=no 

            [filter]
                side=1
                [filter_location]
                    x,y=$dwarf_cloakX,$dwarf_cloakY
                [/filter_location]
            [/filter]

            [message]
                speaker=unit
                message= _ "This cloak is made of shadows. If I wear it, I will be invisible to my enemies at night and underground! (the <i>nightstalk</i> ability)"

                [option]
                    label= _ "I'll wear it."

                    [command]

                    {REMOVE_IMAGE $dwarf_cloakX $dwarf_cloakY}

                    [remove_event]
                        id=take_dwarf_cloak
                    [/remove_event]
                    
                    {CLEAR_VARIABLE dwarf_cloakX}
                    {CLEAR_VARIABLE dwarf_cloakY}

                    [object]
                        name= _ "Shadow Cloak"
                        image=icons/cloak_leather_brown.png
                        description= _ "Woven by ancient masters from the shadows themselves, this cloak will allow for deadly strikes from the shadows, and will make the wily fighter even more insidious."
                            [effect]
                                apply_to=new_ability
                                [abilities]
                                    {ABILITY_NIGHTSTALK}
                                [/abilities]
                            [/effect]
                            [effect]
                                apply_to=overlay 
                                add="misc/item-overlay.png"
                            [/effect]
                    [/object]
                    {FIRST_ITEM_EVENT}
                    [/command]
                [/option]

                [option]
                    label= _ "No, I think someone else should wear it."

                    [command]

                        [allow_undo] 
                        [/allow_undo]
                        
                    [/command]
                [/option]
            [/message]
        [/event]
        [event]
            name=victory
            {CLEAR_VARIABLE dwarf_cloakX}
            {CLEAR_VARIABLE dwarf_cloakY}
        [/event]
    [/event]
[/scenario]
